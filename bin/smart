#!/usr/bin/env node

/**
 * @file 命令行工具启动器
 * @author r2space@gmail.com
 * @copyright Dreamarts Corporation. All Rights Reserved.
 */

"use strict";

/**
 * Module dependencies.
 */
var program   = require("commander")
  , argv      = require("optimist").argv
  , version   = require("../package.json").version;

/**
 * 显示帮助信息
 */
function showHelp() {

  // 定义帮助信息
  program
    .version(version)

    // 数据导入导出
    .option("-e, --export",   "export data.")
    .option("",               "ex. smart --export i18ns --lang ja,en --file i18ns.csv")
    .option("-i, --import",   "import data.")
    .option("",               "ex. smart --import i18ns --lang ja,en --file i18ns.csv")
    .option("--lang",         "language, multiple separated by commas.")
    .option("--file",         "target file name.")

    // 创建Project用（default.js，log4js.js，app.js）
    .option("-g, --generate", "generate application.")
    .option("",               "ex. smart --generate myapp")
    .option("-u, --author",   "project author");

  // 定义帮助信息中的例子
  program.on("--help", function(){
    console.log("  Examples:");
    console.log("");
    console.log("    $ smart -g myapp");
    console.log("");
  });

  program.parse(process.argv);
}

/**
 * Generate application
 */
(function init() {

  showHelp();

  // 导出数据
  var expFile = argv.e || argv.export;
  if (expFile) {

    // 导出i18ns数据
    if (expFile === "i18ns" && typeof argv.file !== "boolean" && typeof argv.lang !== "boolean") {
      require("./data/i18n").exp(argv.file, argv.lang);
      return;
    }

    // TODO:导出master数据
    // TODO:导出user数据
    // TODO:导出group数据
  }

  // 导入数据
  var impFile = argv.i || argv.import;
  if (impFile) {

    require("./data/i18n").imp(argv.file, argv.lang);
    return;
  }

  // 生成应用
  var appName = argv.g || argv.generate;
  if (appName) {

    if ((typeof appName !== "boolean")) {
      var project = require("./generator/project");
      project.create(appName);
      project.installAdmin(appName);
      project.installAppFiles(appName, argv.u);
      return;
    }
  }

  program.help();

})();


