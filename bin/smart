#!/usr/bin/env node

/**
 * @file 命令行工具启动器
 * @author r2space@gmail.com
 * @copyright Dreamarts Corporation. All Rights Reserved.
 */

"use strict";

/**
 * Module dependencies.
 */
var program   = require("commander")
  , argv      = require("optimist").argv
  , version   = require("../package.json").version
  , app       = require("./generator/app")
  , i18n      = require("./data/i18n");

/**
 * 显示帮助信息
 */
function showHelp() {

  // 定义帮助信息
  program
    .version(version)
    .usage("[options]")
    .option("--i18n", "export: output i18n data to csv file, import: load data from csv file.")
    .option("--lang", "language, multiple separated by commas. ex.: ja,en")
    .option("--file", "target file name.")

    .option("--init", "init project")
    .option("--csv", "out")

    .option("--output", "")
    .option("--admin", "add admin");

  // 定义帮助信息中的例子
  program.on("--help", function(){
    console.log("  Examples:");
    console.log("");
    console.log("    $ smart --i18n export --file i18ns.js --lang ja,zh,en");
    console.log("");
  });

  program.parse(process.argv);
}

/**
 * Generate application
 */
(function init() {

  showHelp();

  if (argv.i) {
    app.create(argv.i === true ? "." : argv.i);
    app.installAdmin(argv.i === true ? "." : argv.i);
  }

  if (argv.a) {
    app.installAdmin(argv.a === true ? "." : argv.a);
  }

  if (argv.i18n === "export") {
    var file = (typeof argv.i18n === "boolean") ? undefined : argv.i18n
      , lang = argv.lang ? argv.lang.split(",") : undefined;
    i18n.export(file, lang);
  }

})();
