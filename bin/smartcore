#!/usr/bin/env node

"use strict";

/**
 * Module dependencies.
 */
var program       = require("commander")
  , mkdirp        = require("mkdirp")
  , pkg           = require("../package.json")
  , version       = pkg.version
  , fs            = require("fs")
  , fsext         = require("fs-extra");

// CLI
program
  .version(version)
  .usage("[options] [dir]")
  .parse(process.argv);

// Path
var path = program.args.shift() || ".";

/**
 * Check if the given directory `path` is empty. *
 * @param {String} path
 * @param {Function} fn
 */
function emptyDirectory(path, fn) {
  console.log(path);
  fs.readdir(path, function(err, files) {
    if (err && "ENOENT" !== err.code)  {
      throw err;
    }
    fn(!files || !files.length);
  });
}

/**
 * Mkdir -p.
 * @param {String} path
 * @param {Function} fn
 */
function mkdir(path, fn) {
  mkdirp(path, function(err) {
    if (err) {
      throw err;
    }
    console.log("   [create] : " + path);

    if (fn) {
      fn();
    }
  });
}

/**
 * Exit with the given `str`.
 * @param {String} str
 */
function abort(str) {
  console.error(str);
  process.exit(1);
}

/**
 * Create application at the given directory `path`.
 * @param {String} path
 */
function createApplicationAt(path) {

  console.log("----");
  console.log(global.__dirname);

  fsext.mkdirsSync(path + "/apis");
  fsext.mkdirsSync(path + "/controllers");
  fsext.mkdirsSync(path + "/logs");
  fsext.mkdirsSync(path + "/models");
  fsext.mkdirsSync(path + "/routes");
  fsext.mkdirsSync(path + "/views");

  fsext.mkdirsSync(path + "/public");
  fsext.mkdirsSync(path + "/public/javascripts");
  fsext.mkdirsSync(path + "/public/images");
  fsext.mkdirsSync(path + "/public/stylesheets");

}

// Generate application
(function createApplication(path) {

  createApplicationAt(path);

})(path);
