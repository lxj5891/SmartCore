#!/usr/bin/env node

"use strict";

/**
 * Module dependencies.
 */
var program       = require("commander")
  , pkg           = require("../package.json")
  , version       = pkg.version
  , p             = require("path")
  , fsext         = require("fs-extra");

// CLI
program
  .version(version)
  .usage("[options] [dir]")
  .parse(process.argv);

// Path
var path = program.args.shift() || ".";

/**
 * Create application at the given directory `path`.
 * @param {String} path
 */
function createApplicationAt(path) {

  fsext.mkdirsSync(path + "/apis");
  fsext.mkdirsSync(path + "/controllers");
  fsext.mkdirsSync(path + "/logs");
  fsext.mkdirsSync(path + "/models");
  fsext.mkdirsSync(path + "/routes");

  fsext.mkdirsSync(path + "/views");
  fsext.mkdirsSync(path + "/public");
  fsext.mkdirsSync(path + "/public/javascripts");
  fsext.mkdirsSync(path + "/public/images");
  fsext.mkdirsSync(path + "/public/stylesheets");
}

/**
 *
 * @param path
 */
function installAdmin(path) {

  var src = p.resolve(__dirname , "..");

  fsext.copySync(src + "/app/admin",                path + "/smartadmin");
  fsext.copySync(src + "/app/views/smartadmin",     path + "/views/smartadmin");
  fsext.copySync(src + "/app/public/smart",         path + "/public/smart");
  fsext.copySync(src + "/app/public/smartadmin",    path + "/public/smartadmin");
}

/**
 * Generate application
 */
(function createApplication(path) {

  createApplicationAt(path);
  installAdmin(path);

})(path);
